{% extends '::base.html.twig' %}

{% block title %}{{ title }}{% endblock %}
{% block description %}{{ description }}{% endblock %}
{% block keywords %}{{ keywords }}{% endblock %}

{% block body %}
    <div class="row gallery-row catalog">
        <div class="span1"></div>
        <div class="span10">
            <div class="row clearfix">
                <div class="span12">
                    <div class="navbar hidden-phone">
                        <div class="h5" style="float: left; font-weight: bold;color: black;">Города: </div>
                        <ul class="nav" style="margin-top: -10px;">
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="{{ path('page_catalog', {"country":city.country.url, 'city':city.url}) }}">{{ city.name }}<b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    {% for cityN in cities if cityN.country.url == 'ru' %}
                                        {% if cityN.id != city.id %}
                                            <li>
                                                <a href="{{ path('page_catalog', {"country":cityN.country.url, 'city':cityN.url}) }}">{{ cityN.name }}</a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            {#<div class="row clearfix">#}
                {#<div class="span12">#}
                    {#<div class="h3">Виды услуг:</div>#}
                    {#<div>#}
                        {#<ul>#}
                            {#<li>asdasd</li>#}
                            {#<li>asdasd</li>#}
                            {#<li>asdasd</li>#}
                            {#<li>asdasd</li>#}
                            {#<li>asdasd</li>#}
                        {#</ul>#}
                    {#</div>#}
                {#</div>#}
            {#</div>#}
            <div class="row clearfix">
                <div id="map"></div>
            </div>
            <div class="row clearfix">
                {% for company in companies %}
                <div class="row">
                    <div class="span4">
                        <a href="{{ path('client_company_show', {
                        "country_url": company.city.country.url,
                        "city_url": company.city.url,
                        "company_url": company.url
                        }) }}" rel="nofollow">
                            <div class="block_logo">
                                <img src="{{ company.getWebPath() | apply_filter('thumbnail_catalog_company') }}" alt="{{ company.getImageAltView() }}">
                            </div>
                        </a>
                    </div>
                    <div class="span6">
                        <div class="h5"><a href="{{ path('client_company_show', {
                            "country_url": company.city.country.url,
                            "city_url": company.city.url,
                            "company_url": company.url
                            }) }}">{{ company.name }}</a></div>
                        {#<p>Vivamus augue nulla, vestibulum ac ultrices posuere, vehicula ac arcu. Quisque nisi lacus, bibendum quis commodo eget, lobortis eget elit. Cras venenatis mauris eu tortor consequat a convallis nulla molestie. Phasellus malesuada malesuada velit et fermentum. Proin ut leo nec mauris pulvinar volutpat. Sed ac neque nec leo condimentum rhoncus. Nunc dapibus odio et lacus elementum congue. Praesent nulla arcu, condimentum eu lobortis sit amet, pretium vitae metus. </p>#}

                        <blockquote>
                            <small><strong>Отзывов: <a href="{{ path('client_company_show_comments', {
                                    "country_url": company.city.country.url,
                                    "city_url": company.city.url,
                                    "company_url": company.url
                                    }) }}">{{ company.comments|length }}</a></strong></small>
                            <small><strong>Рейтинг: {% if company.rating == 0 %}0.00{% else %}{{ company.rating/100 }}{% endif %}</strong></small>
                        </blockquote>

                        {#<button class="btn btn-small btn-inverse" type="button">Find out more</button>#}
                    </div>
                </div>
                <hr/>
                {% endfor %}
            </div>
        </div>
        <div class="span1"></div>
    </div>
{% endblock %}

{% block stylesheets_after %}
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link rel="stylesheet" href="http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.ie.css" /><![endif]-->
    <style>
        #map { height: 280px; }
    </style>
{% endblock %}
{% block javascripts %}
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="http://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster-src.js"></script>
    <script>
        var map = L.map('map').setView([{{ city.lat }}, {{ city.lng }}], 12);
        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 21,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="http://mapbox.com">Mapbox</a>',
            id: 'examples.map-i875mjb7'
        }).addTo(map);

        var markers = new L.MarkerClusterGroup();
        {% for company in companies %}
            {% for point in company.points %}
                var marker = L.marker([{{ point.lat }}, {{ point.lng }}]);
                    marker
                            .bindPopup("<a href=\"{{ path('client_company_show', {
                                "country_url": company.city.country.url,
                                "city_url": company.city.url,
                                "company_url": company.url
                                }) }}\">{{ company.name }}</a><br />{{ point.address }}").openPopup();
                markers.addLayer(marker);
            {% endfor %}
        {% endfor %}
        map.addLayer(markers);
    </script>
{% endblock %}